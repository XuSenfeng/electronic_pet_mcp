# ota升级

原本的小智使用的时候两个相同大小的分区, 从而达到在运行一个分区的时候可以在另一个分区下载, 这样会导致问题, 两个分区的大小要求是相同的所以导致flash空间的浪费

### 解决方案

使用OTA升级的时候, 不再使用两个相同的程序, 而是用另一个专门的引导分区进行

1. 小智原本的升级部分改为切换分区
2. 在另一个分区里面实际实现升级功能
3. 两者的分区表除了ota代码分区以外使用相同的大小

## 实际使用

下载ota切换分区的小智代码

下载实际的引导程序

### 注意点

1. 下载的时候需要先下载小智的程序, 从而刷写模型分区的功能
2. 两份代码的ota1分区是实际代码直接运行的部分, 所以可以根据实际的需求进行设置

/home/jiao/esp/v5.4.1/esp-idf/components/bootloader_support/src/esp_image_format.c

![image-20250910122652772](https://picture-01-1316374204.cos.ap-beijing.myqcloud.com/lenovo-picture/202509101226869.png)